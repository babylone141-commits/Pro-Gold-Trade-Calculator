<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pro Gold Trade Calculator V20 â€“ Multi Theme Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0e0e0e;
  --card-bg: rgba(255, 255, 255, 0.05);
  --text: #f5f5f5;
  --accent: #d4af37;
  --success: #22c55e;
  --error: #ef4444;
  --breakeven: #9ca3af;
  --label-border: rgba(255,255,255,0.2);
}

/* Base */
body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 40px 0;
  transition: all 0.4s;
}
.container {
  width: 90%;
  max-width: 1300px;
  margin: auto;
  background: var(--card-bg);
  border-radius: 20px;
  backdrop-filter: blur(12px);
  box-shadow: 0 4px 25px rgba(0,0,0,0.4);
  padding: 30px 35px;
  transition: all 0.4s;
}
h2 { text-align: center; color: var(--accent); letter-spacing: 1px; margin-bottom: 25px; }
h3 { margin-top: 25px; color: var(--text); border-left: 4px solid var(--accent); padding-left: 10px; }

/* Inputs & selects */
label { display: flex; flex-direction: column; margin: 6px; font-size: 14px; }
input, select {
  background: rgba(255,255,255,0.15);
  border: 1px solid var(--label-border);
  border-radius: 10px;
  color: var(--text);
  padding: 8px 12px;
  font-size: 14px;
  transition: all 0.3s;
}
input:focus, select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 6px var(--accent);
}

/* Buttons */
button {
  border: none;
  border-radius: 10px;
  padding: 8px 16px;
  margin: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s;
}
button.primary { background: var(--accent); color: var(--bg); }
button.primary:hover { box-shadow: 0 0 15px var(--accent); transform: translateY(-1px); }
button.reset { background: var(--error); color: white; }
button.csv { background: var(--success); color: white; }
button.theme-btn { background: rgba(255,255,255,0.1); color: var(--text); float:right; }

/* Result boxes */
.result-box {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  padding: 15px;
  border-radius: 12px;
  margin-top: 15px;
  font-size: 14px;
  color: var(--text);
  transition: all 0.3s;
}

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 25px;
  font-size: 13px;
  transition: all 0.3s;
}
th, td { padding: 10px 8px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
thead { background: rgba(255,255,255,0.1); color: var(--accent); font-weight: 600; }
tr.breakeven-row { background: rgba(128,128,128,0.1); color: var(--breakeven); }
tr:hover { background: rgba(255,255,255,0.08); }
tr { animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

/* Colors */
.green { color: var(--success); font-weight: 600; }
.red { color: var(--error); font-weight: 600; }
.gray { color: var(--breakeven); font-weight: 600; }

/* RR Bar */
.rr-bar { height: 12px; border-radius: 6px; background-color: gray; margin: 5px 0; transition: all 0.3s; }
.rr-bar.tp { background-color: var(--success); }
.rr-bar.sl { background-color: var(--error); }
.rr-bar.be { background-color: var(--breakeven); }

/* New Trade Grid */
.trade-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
.trade-grid label { margin-bottom: 0; }

/* Filter */
#filterOutcome { margin-left: 10px; padding: 4px 8px; }
</style>
</head>
<body>
<div class="container">
<button class="theme-btn" onclick="toggleTheme()">ðŸŒ— Mode</button>
<h2>Pro Gold Trade Calculator</h2>

<div style="display:flex; gap:10px; flex-wrap:wrap;">
  <label>Initial Balance: <input type="number" id="balance" value="50000"></label>
  <label>Profit Share (%): <input type="number" id="profitShare" value="90"></label>
</div>

<hr>
<h3>New Trade</h3>
<div class="trade-grid">
  <label>Date: <input type="date" id="tradeDate"></label>
  <label>Type:
    <select id="tradeType">
      <option value="buy">Buy</option>
      <option value="sell">Sell</option>
    </select>
  </label>
  <label>Entry: <input type="number" id="entryPrice" value="4250"></label>
  <label>SL: <input type="number" id="slPrice" value="4245"></label>
  <label>TP: <input type="number" id="tpPrice" value="4260"></label>
  <label>Risk %: <input type="number" id="riskPercent" value="0.5"></label>
  <label>Outcome:
    <select id="tradeOutcome">
      <option value="TP">TP</option>
      <option value="SL">SL</option>
      <option value="BE">Breakeven</option>
    </select>
  </label>
</div>

<div style="margin-top:10px;">
  <button class="primary" onclick="calculateOnly()">Calculate</button>
  <button class="primary" onclick="addTrade()">Add Trade</button>
  <button class="reset" onclick="resetTrades()">Reset</button>
  <button class="csv" onclick="exportCSV()">Export CSV</button>
</div>

<div class="result-box" id="calculatedResult">
<strong>Calculation Details:</strong><br>Fill in the trade then click Calculate.
</div>

<div class="result-box" id="summary">
<strong>Account Summary:</strong> Balance: $50,000 | Winrate: 0%
</div>

<div>
<label>Filter Outcome:
<select id="filterOutcome" onchange="updateTable()">
  <option value="ALL">ALL</option>
  <option value="TP">TP</option>
  <option value="SL">SL</option>
  <option value="BE">Breakeven</option>
</select>
</label>
</div>

<table id="tradesTable">
<thead>
<tr>
  <th>#</th><th>Date</th><th>Type</th><th>Entry</th><th>SL</th><th>TP</th><th>Lot</th>
  <th>Pot. Profit</th><th>Pot. Loss</th><th>Realized</th><th>Net</th><th>Balance</th><th>X</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
let trades=[], lastCalculated={}, themeIndex=0;
const themes=[
  {bg:"#0e0e0e", card:"#050505", text:"#f5f5f5", accent:"#d4af37", success:"#22c55e", error:"#ef4444", breakeven:"#9ca3af", labelBorder:"rgba(255,255,255,0.2)"},
  {bg:"#f9f9f9", card:"#ffffff", text:"#222", accent:"#b48e2d", success:"#16a34a", error:"#dc2626", breakeven:"#6b7280", labelBorder:"#000000"},
  {bg:"#0f172a", card:"rgba(255,255,255,0.08)", text:"#e2e8f0", accent:"#38bdf8", success:"#34d399", error:"#f87171", breakeven:"#9ca3af", labelBorder:"rgba(255,255,255,0.2)"}
];

window.onload=()=>{
  document.getElementById('tradeDate').value=new Date().toISOString().split('T')[0];
  const saved=localStorage.getItem('trades'); if(saved){ trades=JSON.parse(saved); }
  applyTheme();
  updateTable();
}

function applyTheme(){
  const t = themes[themeIndex];
  document.documentElement.style.setProperty('--bg', t.bg);
  document.documentElement.style.setProperty('--card-bg', t.card);
  document.documentElement.style.setProperty('--text', t.text);
  document.documentElement.style.setProperty('--accent', t.accent);
  document.documentElement.style.setProperty('--success', t.success);
  document.documentElement.style.setProperty('--error', t.error);
  document.documentElement.style.setProperty('--breakeven', t.breakeven);
  document.documentElement.style.setProperty('--label-border', t.labelBorder);
}

function toggleTheme(){
  themeIndex = (themeIndex + 1) % themes.length;
  applyTheme();
  updateTable();
}

// Trade Calculations
function calculateOnly(){
  const balance = trades.length ? trades[trades.length-1].balanceActuelle : parseFloat(document.getElementById('balance').value);
  const type = document.getElementById('tradeType').value;
  const entry = parseFloat(document.getElementById('entryPrice').value);
  const sl = parseFloat(document.getElementById('slPrice').value);
  const tp = parseFloat(document.getElementById('tpPrice').value);
  const riskPercent = parseFloat(document.getElementById('riskPercent').value)/100;
  const date = document.getElementById('tradeDate').value;
  const profitShare = parseFloat(document.getElementById('profitShare').value)/100;
  const outcome = document.getElementById('tradeOutcome').value;

  let slDiff = type==='buy' ? Math.abs(entry-sl) : Math.abs(sl-entry);
  let tpDiff = type==='buy' ? tp-entry : entry-tp;

  let lot = (balance*riskPercent)/(slDiff*100); lot=Math.floor(lot*100)/100;
  if(lot<0.01){ alert("Lot <0.01"); return; }

  let potentialProfit = lot*tpDiff*100, potentialLoss = lot*slDiff*100, profitReel=0;
  if(outcome==='TP') profitReel=potentialProfit;
  else if(outcome==='SL') profitReel=-potentialLoss;
  else { profitReel=0; potentialProfit=0; potentialLoss=0; }

  const profitNet = profitReel*profitShare;
  lastCalculated={date,type,entry,sl,tp,lot,potentialProfit,potentialLoss,profitReel,profitNet,isBreakeven: outcome==='BE'};
  
  document.getElementById("calculatedResult").innerHTML=renderResult(lastCalculated);
}

function renderResult(calc){
  let rrRatioDisplay='', potProfitDisplay='', potLossDisplay='', profitColor=calc.profitReel>=0?'green':'red';
  let rrClass = calc.isBreakeven?'be':calc.profitReel>=0?'tp':'sl';
  if(calc.isBreakeven){ 
    potProfitDisplay=`$${calc.potentialProfit.toFixed(2)}`; 
    potLossDisplay=`$${calc.potentialLoss.toFixed(2)}`; 
    rrRatioDisplay='0.00'; profitColor='gray'; 
  } else { 
    rrRatioDisplay=(calc.potentialProfit/calc.potentialLoss).toFixed(2);
    potProfitDisplay=`$${calc.potentialProfit.toFixed(2)}`; 
    potLossDisplay=`$${calc.potentialLoss.toFixed(2)}`;
  }
  return `<strong>Calculation Details:</strong><br>
    Date: ${calc.date}<br>
    Type: ${calc.type.toUpperCase()}<br>
    Lot: ${calc.lot.toFixed(2)}<br>
    Pot. Profit: ${potProfitDisplay}<br>
    Pot. Loss: ${potLossDisplay}<br>
    R/R: ${rrRatioDisplay} <div class="rr-bar ${rrClass}"></div>
    <span class="${profitColor}">Net P.: $${calc.profitNet.toFixed(2)}</span>`;
}

// Add Trade
function addTrade(){
  if(!lastCalculated.lot){ alert("Calculate first"); return; }
  trades.push({...lastCalculated});
  localStorage.setItem('trades',JSON.stringify(trades));
  updateTable();
  lastCalculated={};
  document.getElementById("calculatedResult").innerHTML="<span class='green'>Trade added!</span>";
}

// Update Table with filter and winrate
function updateTable(){
  const tbody = document.querySelector("#tradesTable tbody");
  tbody.innerHTML="";
  const filter = document.getElementById('filterOutcome').value;
  let currentBalance=parseFloat(document.getElementById('balance').value), totalProfit=0, totalNet=0, winCount=0;

  trades.forEach((t,i)=>{
    if(filter!=='ALL' && (t.isBreakeven?'BE':t.profitReel>0?'TP':'SL')!==filter) return;
    t.balanceActuelle = currentBalance + t.profitReel;
    currentBalance = t.balanceActuelle; totalProfit+=t.profitReel; totalNet+=t.profitNet;
    if(t.profitReel>0) winCount++;
    const rowClass = t.isBreakeven?'breakeven-row':'';
    tbody.innerHTML+=`<tr class="${rowClass}"><td>${i+1}</td><td>${t.date}</td><td>${t.type.toUpperCase()}</td>
      <td>${t.entry}</td><td>${t.sl}</td><td>${t.tp}</td><td>${t.lot.toFixed(2)}</td>
      <td>${t.potentialProfit.toFixed(2)}</td><td>${t.potentialLoss.toFixed(2)}</td>
      <td>${t.profitReel.toFixed(2)}</td><td>${t.profitNet.toFixed(2)}</td><td>${t.balanceActuelle.toFixed(2)}</td>
      <td><button onclick="deleteTrade(${i})">X</button></td></tr>`;
  });
  const winRate = trades.length ? ((winCount/trades.length)*100).toFixed(1)+'%' : '0%';
  document.getElementById("summary").innerHTML=`<strong>Account Summary:</strong> Balance: $${currentBalance.toFixed(2)} | Winrate: ${winRate}`;
}

// Reset/Delete/Export
function resetTrades(){ trades=[]; localStorage.removeItem('trades'); updateTable(); document.getElementById("calculatedResult").innerHTML="History cleared."; }
function deleteTrade(index){ trades.splice(index,1); localStorage.setItem('trades',JSON.stringify(trades)); updateTable(); }
function exportCSV(){
  if(trades.length===0){ alert("No trades"); return; }
  let csv="Date,Type,Entry,SL,TP,Lot,Pot. Profit,Pot. Loss,Realized P.,Net P.,Balance\n";
  trades.forEach(t=>{
    csv+=`${t.date},${t.type},${t.entry},${t.sl},${t.tp},${t.lot.toFixed(2)},${t.potentialProfit.toFixed(2)},${t.potentialLoss.toFixed(2)},${t.profitReel.toFixed(2)},${t.profitNet.toFixed(2)},${t.balanceActuelle.toFixed(2)}\n`;
  });
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download="trades_export.csv"; a.click();
}
</script>
</body>
</html>
